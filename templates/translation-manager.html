<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>i18n translator</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background: #f5f5f5;
                color: #333;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
            }

            .header {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .header h1 {
                color: #1890ff;
                margin-bottom: 10px;
            }

            .stats {
                display: flex;
                gap: 20px;
                margin-top: 15px;
            }

            .stat-item {
                background: #f0f9ff;
                padding: 10px 15px;
                border-radius: 6px;
                border-left: 4px solid #1890ff;
            }

            .controls {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .control-group {
                display: flex;
                gap: 15px;
                align-items: center;
                margin-bottom: 15px;
            }

            .control-group:last-child {
                margin-bottom: 0;
            }

            input,
            select,
            button {
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 14px;
            }

            button {
                background: #1890ff;
                color: white;
                border: none;
                cursor: pointer;
                transition: background 0.3s;
            }

            button:hover {
                background: #40a9ff;
            }

            button.secondary {
                background: #52c41a;
            }

            button.secondary:hover {
                background: #73d13d;
            }

            button.danger {
                background: #ff4d4f;
            }

            button.danger:hover {
                background: #ff7875;
            }

            .table-container {
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            th,
            td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #f0f0f0;
            }

            th {
                background: #fafafa;
                font-weight: 600;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            tr:hover {
                background: #f5f5f5;
            }

            .translation-cell {
                max-width: 200px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .translation-cell:hover {
                white-space: normal;
                overflow: visible;
            }

            .key-cell {
                font-family: "Monaco", "Menlo", monospace;
                background: #f6f8fa;
                border-radius: 3px;
                padding: 4px 6px;
                font-size: 12px;
            }

            .file-badge {
                background: #e6f7ff;
                color: #1890ff;
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 12px;
            }

            .actions {
                display: flex;
                gap: 5px;
            }

            .btn-small {
                padding: 4px 8px;
                font-size: 12px;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1000;
            }

            .modal-content {
                background: white;
                margin: 50px auto;
                padding: 20px;
                border-radius: 8px;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 1px solid #f0f0f0;
            }

            .close {
                font-size: 24px;
                cursor: pointer;
                color: #999;
            }

            .close:hover {
                color: #333;
            }

            .form-group {
                margin-bottom: 15px;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 8px 12px;
                border: 1px solid #ddd;
                border-radius: 4px;
            }

            .form-group textarea {
                min-height: 60px;
                resize: vertical;
            }

            .lang-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 15px;
            }

            .loading {
                text-align: center;
                padding: 40px;
                color: #999;
            }

            .message {
                padding: 10px 15px;
                border-radius: 4px;
                margin-bottom: 15px;
            }

            .message.success {
                background: #f6ffed;
                border: 1px solid #b7eb8f;
                color: #52c41a;
            }

            .message.error {
                background: #fff2f0;
                border: 1px solid #ffccc7;
                color: #ff4d4f;
            }

            .pagination {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 20px;
                background: white;
                border-top: 1px solid #f0f0f0;
            }

            .pagination-info {
                color: #666;
                font-size: 14px;
            }

            .pagination-controls {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .pagination-controls button {
                padding: 6px 12px;
                font-size: 12px;
            }

            .pagination-controls button:disabled {
                background: #f5f5f5;
                color: #999;
                cursor: not-allowed;
            }

            .page-size-selector {
                display: flex;
                align-items: center;
                gap: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üåç ÁøªËØëÊñá‰ª∂ÁÆ°ÁêÜÂô®</h1>
                <p>ÁÆ°ÁêÜÂ§öËØ≠Ë®ÄÁøªËØëÊñá‰ª∂ÔºåÊîØÊåÅÂÆûÊó∂ÁºñËæëÂíåÂêåÊ≠•</p>
                <div class="stats">
                    <div class="stat-item">
                        <strong id="totalTranslations">0</strong> ÁøªËØëÊù°ÁõÆ
                    </div>
                    <div class="stat-item">
                        <strong id="totalLanguages">0</strong> ÊîØÊåÅËØ≠Ë®Ä
                    </div>
                    <div class="stat-item">
                        <strong id="totalFiles">0</strong> ÁøªËØëÊñá‰ª∂
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="ÊêúÁ¥¢ÁøªËØë key ÊàñÂÜÖÂÆπ..."
                    />
                    <select id="fileFilter">
                        <option value="">ÊâÄÊúâÊñá‰ª∂</option>
                    </select>
                    <select id="languageFilter">
                        <option value="">ÊâÄÊúâËØ≠Ë®Ä</option>
                    </select>
                    <button onclick="searchTranslations()">üîç ÊêúÁ¥¢</button>
                    <button onclick="clearFilters()" class="secondary">
                        Ê∏ÖÈô§Á≠õÈÄâ
                    </button>
                    <div class="page-size-selector">
                        <span>ÊØèÈ°µÊòæÁ§∫:</span>
                        <select id="pageSizeSelect" onchange="changePageSize()">
                            <option value="20">20</option>
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                    </div>
                </div>
                <div class="control-group">
                    <button onclick="addTranslation()" class="secondary">
                        ‚ûï Ê∑ªÂä†ÁøªËØë
                    </button>
                    <button onclick="showAddFileModal()" class="secondary"
                        style="background: #ff9800; border-color: #ff9800;">
                        üìÑ Êñ∞Â¢ûÊñá‰ª∂
                    </button>
                    <button onclick="batchTranslate()" class="secondary">
                        ü§ñ ÊâπÈáèÁøªËØë
                    </button>
                    <button onclick="refreshData()">‚ôªÔ∏è Âà∑Êñ∞Êï∞ÊçÆ</button>
                    <button onclick="exportData()" class="secondary">
                        üì• ÂØºÂá∫Êï∞ÊçÆ
                    </button>
                </div>
            </div>

            <div id="messageContainer"></div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Key</th>
                            <th>Êñá‰ª∂</th>
                            <th>‰∏≠Êñá</th>
                            <th>Ëã±Êñá</th>
                            <th>
                                <select
                                    id="headerLanguageSelect"
                                    onchange="changeHeaderLanguage()"
                                    style="margin-left: 10px; font-size: 12px"
                                >
                                    <option value="">ÈÄâÊã©ËØ≠Ë®Ä...</option>
                                </select>
                            </th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="translationsTable">
                        <tr>
                            <td colspan="6" class="loading">Âä†ËΩΩ‰∏≠...</td>
                        </tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <div class="pagination-info">
                        <span id="paginationInfo"
                            >ÊòæÁ§∫Á¨¨ 1-50 Êù°ÔºåÂÖ± 0 Êù°ËÆ∞ÂΩï</span
                        >
                    </div>
                    <div class="pagination-controls">
                        <button
                            id="firstPageBtn"
                            onclick="goToPage(1)"
                            disabled
                        >
                            È¶ñÈ°µ
                        </button>
                        <button
                            id="prevPageBtn"
                            onclick="goToPage(currentPage - 1)"
                            disabled
                        >
                            ‰∏ä‰∏ÄÈ°µ
                        </button>
                        <span id="pageInfo"> 1 / 1 </span>
                        <button
                            id="nextPageBtn"
                            onclick="goToPage(currentPage + 1)"
                            disabled
                        >
                            ‰∏ã‰∏ÄÈ°µ
                        </button>
                        <button
                            id="lastPageBtn"
                            onclick="goToPage(totalPages)"
                            disabled
                        >
                            Êú´È°µ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê∂àÊÅØÂºπÁ™ó -->
        <div id="messageModal" class="modal" style="z-index: 10000">
            <div
                class="modal-content"
                style="max-width: 400px; margin: 20% auto"
            >
                <div class="modal-header">
                    <h3 id="messageTitle">ÊèêÁ§∫</h3>
                    <span class="close" onclick="closeMessageModal()"
                        >&times;</span
                    >
                </div>
                <div class="modal-body">
                    <div
                        id="messageIcon"
                        style="
                            text-align: center;
                            font-size: 48px;
                            margin-bottom: 15px;
                        "
                    ></div>
                    <p
                        id="messageText"
                        style="text-align: center; margin: 0; font-size: 16px"
                    ></p>
                </div>
                <div style="text-align: center; margin-top: 20px">
                    <button
                        onclick="closeMessageModal()"
                        class="secondary"
                        style="margin: 0 auto"
                    >
                        Á°ÆÂÆö
                    </button>
                </div>
            </div>
        </div>

        <!-- Êñ∞Â¢ûÊñá‰ª∂Ê®°ÊÄÅÊ°Ü -->
        <div id="addFileModal" class="modal">
            <div class="modal-content" style="max-width: 500px">
                <div class="modal-header">
                    <h3>Êñ∞Â¢ûÁøªËØëÊñá‰ª∂</h3>
                    <span class="close" onclick="closeAddFileModal()">&times;</span>
                </div>
                <form id="addFileForm">
                    <div class="form-group">
                        <label for="newFileName">Êñá‰ª∂Âêç:</label>
                        <input type="text" id="newFileName" required 
                            placeholder="‰æãÂ¶Ç: new-feature" />
                        <small style="color: #999; font-size: 12px;">
                            Â∞ÜÂú®ÊâÄÊúâËØ≠Ë®ÄÊñá‰ª∂Â§π‰∏ãÂàõÂª∫ÂØπÂ∫îÁöÑ JSON Êñá‰ª∂
                        </small>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="button" onclick="closeAddFileModal()">
                            ÂèñÊ∂à
                        </button>
                        <button type="submit" class="secondary">
                            ÂàõÂª∫Êñá‰ª∂
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ÁºñËæëÁøªËØëÊ®°ÊÄÅÊ°Ü -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">ÁºñËæëÁøªËØë</h3>
                    <span class="close" onclick="closeModal()">&times;</span>
                </div>
                <form id="editForm">
                    <div class="form-group">
                        <label for="editKey">Key:</label>
                        <input type="text" id="editKey" required />
                    </div>
                    <div class="form-group">
                        <label for="editFile">Êñá‰ª∂:</label>
                        <select id="editFile" required></select>
                    </div>
                    <div>
                        <button
                            type="button"
                            onclick="autoTranslateInModal()"
                            class="secondary"
                            style="background: #28a745; border-color: #28a745"
                            title="‰∏ÄÈîÆÁøªËØë"
                        >
                            ü§ñ ‰∏ÄÈîÆÁøªËØë
                        </button>
                    </div>
                    <div class="lang-grid" id="languageInputs">
                        <!-- Âä®ÊÄÅÁîüÊàêËØ≠Ë®ÄËæìÂÖ•Ê°Ü -->
                    </div>
                    <div
                        style="
                            margin-top: 20px;
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                        "
                    >
                        <div>
                            <button type="button" onclick="closeModal()">
                                ÂèñÊ∂à
                            </button>
                            <button
                                type="submit"
                                class="secondary"
                                style="margin-left: 10px"
                            >
                                ‰øùÂ≠ò
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <script>
            const API_BASE = "/api";
            let allTranslations = [];
            let filteredTranslations = [];
            let languages = [];
            let files = [];
            let currentEditId = null;
            let selectedHeaderLanguage = ""; // Ë°®Â§¥ÈÄâ‰∏≠ÁöÑËØ≠Ë®Ä

            // ÊÄßËÉΩ‰ºòÂåñÔºöÊêúÁ¥¢ÁªìÊûúÁºìÂ≠ò
            const searchCache = new Map();
            const MAX_CACHE_SIZE = 50;

            // ÂàÜÈ°µÁõ∏ÂÖ≥ÂèòÈáè
            let currentPage = 1;
            let pageSize = 50;
            let totalPages = 1;

            // ÂàùÂßãÂåñ
            document.addEventListener("DOMContentLoaded", function () {
                loadInitialData();

                // ÊêúÁ¥¢Ê°ÜÂÆûÊó∂ÊêúÁ¥¢‰∫ã‰ª∂Ôºà‰ΩøÁî®Èò≤ÊäñÔºâ
                document
                    .getElementById("searchInput")
                    .addEventListener("input", debouncedFilter);

                // ÊêúÁ¥¢Ê°ÜÂõûËΩ¶‰∫ã‰ª∂ÔºàÁ´ãÂç≥ÊêúÁ¥¢Ôºâ
                document
                    .getElementById("searchInput")
                    .addEventListener("keypress", function (e) {
                        if (e.key === "Enter") {
                            filterTranslations();
                        }
                    });

                // ËøáÊª§Âô®ÂèòÂåñ‰∫ã‰ª∂
                document
                    .getElementById("fileFilter")
                    .addEventListener("change", filterTranslations);

                document
                    .getElementById("languageFilter")
                    .addEventListener("change", filterTranslations);

                // Ë°®ÂçïÊèê‰∫§‰∫ã‰ª∂
                document
                    .getElementById("editForm")
                    .addEventListener("submit", function (e) {
                        e.preventDefault();
                        saveTranslation();
                    });
            });

            // Âä†ËΩΩÁøªËØëÊï∞ÊçÆ
            async function loadTranslations() {
                try {
                    // ÂÖàÂà∑Êñ∞ÊúçÂä°Âô®Á´ØÁºìÂ≠ò
                    const refreshRes = await fetch(
                        `${API_BASE}/refresh-cache`,
                        {
                            method: "POST",
                        }
                    );

                    if (!refreshRes.ok) {
                        throw new Error("Âà∑Êñ∞ÁºìÂ≠òÂ§±Ë¥•");
                    }

                    // Ê∏ÖÈô§ÂâçÁ´ØÊêúÁ¥¢ÁºìÂ≠ò
                    searchCache.clear();

                    // ÁÑ∂ÂêéËé∑ÂèñÊúÄÊñ∞ÁöÑÁøªËØëÊï∞ÊçÆ
                    const translationsRes = await fetch(
                        `${API_BASE}/translations`
                    );
                    allTranslations = await translationsRes.json();
                    filterTranslations();
                } catch (error) {
                    showMessage("Âä†ËΩΩÁøªËØëÊï∞ÊçÆÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // Âä†ËΩΩÂàùÂßãÊï∞ÊçÆ
            async function loadInitialData() {
                try {
                    const [translationsRes, languagesRes, filesRes] =
                        await Promise.all([
                            fetch(`${API_BASE}/translations`),
                            fetch(`${API_BASE}/languages`),
                            fetch(`${API_BASE}/files`),
                        ]);

                    allTranslations = await translationsRes.json();
                    languages = await languagesRes.json();
                    files = await filesRes.json();

                    updateStats();
                    populateFilters();
                    filteredTranslations = allTranslations;
                    updatePagination();
                    renderCurrentPage();
                } catch (error) {
                    showMessage("Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
            function updateStats() {
                document.getElementById("totalTranslations").textContent =
                    allTranslations.length;
                document.getElementById("totalLanguages").textContent =
                    languages.length;
                document.getElementById("totalFiles").textContent =
                    files.length;
            }

            // Â°´ÂÖÖËøáÊª§Âô®ÈÄâÈ°π
            function populateFilters() {
                const fileFilter = document.getElementById("fileFilter");
                const languageFilter =
                    document.getElementById("languageFilter");
                const editFileSelect = document.getElementById("editFile");
                const headerLanguageSelect = document.getElementById(
                    "headerLanguageSelect"
                );

                // Ê∏ÖÁ©∫Áé∞ÊúâÈÄâÈ°π
                fileFilter.innerHTML = '<option value="">ÊâÄÊúâÊñá‰ª∂</option>';
                languageFilter.innerHTML = '<option value="">ÊâÄÊúâËØ≠Ë®Ä</option>';
                editFileSelect.innerHTML = "";
                headerLanguageSelect.innerHTML =
                    '<option value="">ÈÄâÊã©ËØ≠Ë®Ä...</option>';

                // Ê∑ªÂä†Êñá‰ª∂ÈÄâÈ°π
                files.forEach((file) => {
                    fileFilter.innerHTML += `<option value="${file}">${file}</option>`;
                    editFileSelect.innerHTML += `<option value="${file}">${file}</option>`;
                });

                // Ê∑ªÂä†ËØ≠Ë®ÄÈÄâÈ°π
                languages.forEach((lang) => {
                    const langName = getLanguageName(lang);
                    languageFilter.innerHTML += `<option value="${lang}">${langName}</option>`;

                    // ‰∏∫Ë°®Â§¥ËØ≠Ë®ÄÈÄâÊã©Âô®Ê∑ªÂä†Èô§‰∏≠ÊñáÂíåËã±ÊñáÂ§ñÁöÑÂÖ∂‰ªñËØ≠Ë®Ä
                    if (lang !== "zh" && lang !== "en") {
                        headerLanguageSelect.innerHTML += `<option value="${lang}">${langName}</option>`;
                    }
                });
            }

            // Ëé∑ÂèñËØ≠Ë®ÄÊòæÁ§∫ÂêçÁß∞
            function getLanguageName(code) {
                const names = {
                    zh: "‰∏≠Êñá",
                    en: "English",
                    "zh-TW": "ÁπÅ‰Ωì‰∏≠Êñá",
                    de: "Deutsch",
                    es: "Espa√±ol",
                    fr: "Fran√ßais",
                    id: "Bahasa Indonesia",
                    ja: "Êó•Êú¨Ë™û",
                    ko: "ÌïúÍµ≠Ïñ¥",
                    ms: "Bahasa Melayu",
                    pt: "Portugu√™s",
                    ru: "–†—É—Å—Å–∫–∏–π",
                    th: "‡πÑ‡∏ó‡∏¢",
                    vi: "Ti·∫øng Vi·ªát",
                };
                return names[code] || code;
            }

            // ÂàÜÈ°µÁõ∏ÂÖ≥ÂáΩÊï∞
            function updatePagination() {
                totalPages = Math.ceil(filteredTranslations.length / pageSize);
                if (currentPage > totalPages) {
                    currentPage = Math.max(1, totalPages);
                }

                // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
                const start = (currentPage - 1) * pageSize + 1;
                const end = Math.min(
                    currentPage * pageSize,
                    filteredTranslations.length
                );
                document.getElementById("paginationInfo").textContent =
                    `ÊòæÁ§∫Á¨¨ ${start}-${end} Êù°ÔºåÂÖ± ${filteredTranslations.length} Êù°ËÆ∞ÂΩï`;
                document.getElementById("pageInfo").textContent =
                    ` ${currentPage} / ${totalPages}`;

                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                document.getElementById("firstPageBtn").disabled =
                    currentPage === 1;
                document.getElementById("prevPageBtn").disabled =
                    currentPage === 1;
                document.getElementById("nextPageBtn").disabled =
                    currentPage === totalPages;
                document.getElementById("lastPageBtn").disabled =
                    currentPage === totalPages;
            }

            function goToPage(page) {
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    updatePagination();
                    renderCurrentPage();
                }
            }

            function changePageSize() {
                pageSize = parseInt(
                    document.getElementById("pageSizeSelect").value
                );
                currentPage = 1;
                updatePagination();
                renderCurrentPage();
            }

            function renderCurrentPage() {
                const start = (currentPage - 1) * pageSize;
                const end = start + pageSize;
                const pageData = filteredTranslations.slice(start, end);
                renderTranslations(pageData);
            }

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            function showLoadingState() {
                const tbody = document.getElementById("translationsTable");
                tbody.innerHTML =
                    '<tr><td colspan="6" class="loading">Ê≠£Âú®Âä†ËΩΩ...</td></tr>';
            }

            // Ê∏≤ÊüìÁøªËØëË°®Ê†º
            function renderTranslations(translations) {
                const tbody = document.getElementById("translationsTable");

                if (translations.length === 0) {
                    tbody.innerHTML =
                        '<tr><td colspan="6" class="loading">Ê≤°ÊúâÊâæÂà∞ÁøªËØëÊï∞ÊçÆ</td></tr>';
                    return;
                }

                tbody.innerHTML = translations
                    .map((item) => {
                        // Ëé∑ÂèñË°®Â§¥ÈÄâ‰∏≠ËØ≠Ë®ÄÁöÑÁøªËØëÂÜÖÂÆπ
                        let otherLangContent = "-";
                        if (
                            selectedHeaderLanguage &&
                            item.translations[selectedHeaderLanguage]
                        ) {
                            otherLangContent =
                                item.translations[selectedHeaderLanguage];
                        } else if (selectedHeaderLanguage) {
                            otherLangContent = "(Êú™ÁøªËØë)";
                        }

                        return `
                <tr>
                    <td><code class="key-cell">${item.key}</code></td>
                    <td><span class="file-badge">${item.file}</span></td>
                    <td class="translation-cell" title="${item.translations.zh || ""}">${item.translations.zh || "-"}</td>
                    <td class="translation-cell" title="${item.translations.en || ""}">${item.translations.en || "-"}</td>
                    <td class="translation-cell" title="${otherLangContent}">${otherLangContent}</td>
                    <td>
                        <div class="actions">
                            <button class="btn-small" onclick="editTranslation(${item.id})">ÁºñËæë</button>
                            <button class="btn-small danger" onclick="deleteTranslation(${item.id})">Âà†Èô§</button>
                        </div>
                    </td>
                </tr>
            `;
                    })
                    .join("");
            }

            // Ë°®Â§¥ËØ≠Ë®ÄÈÄâÊã©ÂèòÂåñÂ§ÑÁêÜ
            function changeHeaderLanguage() {
                selectedHeaderLanguage = document.getElementById(
                    "headerLanguageSelect"
                ).value;
                // Ê∏ÖÁêÜÁºìÂ≠òÔºåÂõ†‰∏∫ÊòæÁ§∫ÂÜÖÂÆπÂèëÁîü‰∫ÜÂèòÂåñ
                searchCache.clear();
                // ÈáçÊñ∞Ê∏≤ÊüìÂΩìÂâçÈ°µÈù¢
                renderCurrentPage();
            }

            // Èò≤ÊäñÂáΩÊï∞Ôºå‰ºòÂåñÊêúÁ¥¢ÊÄßËÉΩ
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // ÁîüÊàêÁºìÂ≠òÈîÆ
            function generateCacheKey(
                searchTerm,
                selectedFile,
                selectedLanguage
            ) {
                return `${searchTerm}|${selectedFile}|${selectedLanguage}`;
            }

            // Ê∏ÖÁêÜÁºìÂ≠òÔºàLRUÁ≠ñÁï•Ôºâ
            function cleanCache() {
                if (searchCache.size >= MAX_CACHE_SIZE) {
                    const firstKey = searchCache.keys().next().value;
                    searchCache.delete(firstKey);
                }
            }

            // ÊêúÁ¥¢ÂíåËøáÊª§
            function filterTranslations() {
                const searchTerm = document
                    .getElementById("searchInput")
                    .value.toLowerCase();
                const selectedFile =
                    document.getElementById("fileFilter").value;
                const selectedLanguage =
                    document.getElementById("languageFilter").value;

                // ÁîüÊàêÁºìÂ≠òÈîÆ
                const cacheKey = generateCacheKey(
                    searchTerm,
                    selectedFile,
                    selectedLanguage
                );

                // Ê£ÄÊü•ÁºìÂ≠ò
                if (searchCache.has(cacheKey)) {
                    filteredTranslations = searchCache.get(cacheKey);
                    currentPage = 1;
                    updatePagination();
                    renderCurrentPage();
                    document.getElementById("translationCount").textContent =
                        `ÂÖ±ÊâæÂà∞ ${filteredTranslations.length} Êù°ÁøªËØë`;
                    return;
                }

                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅÔºàÂØπ‰∫éÂ§ßÊï∞ÊçÆÈõÜÔºâ
                if (allTranslations.length > 1000) {
                    showLoadingState();
                }

                // ‰ΩøÁî® requestAnimationFrame Êù•ÈÅøÂÖçÈòªÂ°û UI
                requestAnimationFrame(() => {
                    // Â¶ÇÊûúÊ≤°Êúâ‰ªª‰ΩïËøáÊª§Êù°‰ª∂ÔºåÁõ¥Êé•ÊòæÁ§∫ÊâÄÊúâÊï∞ÊçÆ
                    if (!searchTerm && !selectedFile && !selectedLanguage) {
                        filteredTranslations = allTranslations;
                    } else {
                        // ‰ΩøÁî®Êõ¥È´òÊïàÁöÑËøáÊª§ÈÄªËæë
                        filteredTranslations = allTranslations.filter(
                            (item) => {
                                // Êñá‰ª∂ËøáÊª§ÔºàÊúÄÂø´ÁöÑËøáÊª§Êù°‰ª∂Ôºå‰ºòÂÖàÊ£ÄÊü•Ôºâ
                                if (
                                    selectedFile &&
                                    item.file !== selectedFile
                                ) {
                                    return false;
                                }

                                // ËØ≠Ë®ÄËøáÊª§
                                if (selectedLanguage) {
                                    const langTranslation =
                                        item.translations[selectedLanguage];
                                    if (
                                        !langTranslation ||
                                        langTranslation.trim() === ""
                                    ) {
                                        return false;
                                    }
                                }

                                // ÊêúÁ¥¢ËøáÊª§ÔºàÊúÄËÄóÊó∂ÁöÑÊìç‰ΩúÔºåÊîæÂú®ÊúÄÂêéÔºâ
                                if (searchTerm) {
                                    // È¶ñÂÖàÊ£ÄÊü•keyÔºàÈÄöÂ∏∏Êõ¥Âø´Ôºâ
                                    if (
                                        item.key
                                            .toLowerCase()
                                            .includes(searchTerm)
                                    ) {
                                        return true;
                                    }

                                    // ÁÑ∂ÂêéÊ£ÄÊü•ÁøªËØëÂÜÖÂÆπ
                                    for (const translation of Object.values(
                                        item.translations
                                    )) {
                                        if (
                                            translation &&
                                            translation
                                                .toLowerCase()
                                                .includes(searchTerm)
                                        ) {
                                            return true;
                                        }
                                    }
                                    return false;
                                }

                                return true;
                            }
                        );
                    }

                    // ÁºìÂ≠òÁªìÊûú
                    cleanCache();
                    searchCache.set(cacheKey, [...filteredTranslations]);

                    // ÈáçÁΩÆÂà∞Á¨¨‰∏ÄÈ°µ
                    currentPage = 1;
                    updatePagination();
                    renderCurrentPage();

                    document.getElementById("translationCount").textContent =
                        `ÂÖ±ÊâæÂà∞ ${filteredTranslations.length} Êù°ÁøªËØë`;
                });
            }

            // ÂàõÂª∫Èò≤ÊäñÁâàÊú¨ÁöÑËøáÊª§ÂáΩÊï∞
            const debouncedFilter = debounce(filterTranslations, 300);

            // Ê∏ÖÈô§Á≠õÈÄâ
            function clearFilters() {
                document.getElementById("searchInput").value = "";
                document.getElementById("fileFilter").value = "";
                document.getElementById("languageFilter").value = "";
                filteredTranslations = allTranslations;
                currentPage = 1;
                updatePagination();
                renderCurrentPage();
                document.getElementById("translationCount").textContent =
                    `ÂÖ±ÊâæÂà∞ ${filteredTranslations.length} Êù°ÁøªËØë`;
            }

            // Ê∑ªÂä†ÁøªËØë
            function addTranslation() {
                currentEditId = null;
                document.getElementById("modalTitle").textContent = "Ê∑ªÂä†ÁøªËØë";
                document.getElementById("editKey").value = "";
                document.getElementById("editFile").value = files[0] || "";

                generateLanguageInputs();
                document.getElementById("editModal").style.display = "block";
            }

            // ÁºñËæëÁøªËØë
            function editTranslation(id) {
                const translation = allTranslations.find((t) => t.id === id);
                if (!translation) return;

                currentEditId = id;
                document.getElementById("modalTitle").textContent = "ÁºñËæëÁøªËØë";
                document.getElementById("editKey").value = translation.key;
                document.getElementById("editFile").value = translation.file;

                generateLanguageInputs(translation.translations);
                document.getElementById("editModal").style.display = "block";
            }

            // ÁîüÊàêËØ≠Ë®ÄËæìÂÖ•Ê°Ü
            function generateLanguageInputs(translations = {}) {
                const container = document.getElementById("languageInputs");
                container.innerHTML = languages
                    .map(
                        (lang) => `
                <div class="form-group">
                    <label for="lang-${lang}">${getLanguageName(lang)}:</label>
                    <textarea id="lang-${lang}" data-lang="${lang}" placeholder="ËæìÂÖ•${getLanguageName(lang)}ÁøªËØë...">${translations[lang] || ""}</textarea>
                </div>
            `
                    )
                    .join("");
            }

            // ‰øùÂ≠òÁøªËØë
            async function saveTranslation() {
                const key = document.getElementById("editKey").value;
                const file = document.getElementById("editFile").value;

                const translations = {};
                languages.forEach((lang) => {
                    const input = document.getElementById(`lang-${lang}`);
                    if (input) {
                        translations[lang] = input.value;
                    }
                });

                const data = {
                    key,
                    file,
                    translations,
                    updatedAt: new Date().toISOString(),
                };

                try {
                    let response;
                    if (currentEditId) {
                        // Êõ¥Êñ∞Áé∞ÊúâÁøªËØë
                        response = await fetch(
                            `${API_BASE}/translations/${currentEditId}`,
                            {
                                method: "PUT",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    ...data,
                                    id: currentEditId,
                                }),
                            }
                        );
                    } else {
                        // Ê∑ªÂä†Êñ∞ÁøªËØë
                        response = await fetch(`${API_BASE}/translations`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                ...data,
                                id: Date.now(),
                                createdAt: new Date().toISOString(),
                            }),
                        });
                    }

                    if (response.ok) {
                        showMessage("ÁøªËØë‰øùÂ≠òÊàêÂäü", "success");
                        closeModal();
                        refreshData();
                    } else {
                        throw new Error("‰øùÂ≠òÂ§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("‰øùÂ≠òÁøªËØëÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // Âà†Èô§ÁøªËØë
            async function deleteTranslation(id) {
                if (!confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÁøªËØëÂêóÔºü")) return;

                try {
                    const response = await fetch(
                        `${API_BASE}/translations/${id}`,
                        {
                            method: "DELETE",
                        }
                    );

                    if (response.ok) {
                        showMessage("ÁøªËØëÂà†Èô§ÊàêÂäü", "success");
                        refreshData();
                    } else {
                        throw new Error("Âà†Èô§Â§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("Âà†Èô§ÁøªËØëÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // Âà∑Êñ∞Êï∞ÊçÆ
            async function refreshData() {
                showMessage("Ê≠£Âú®Âà∑Êñ∞Êï∞ÊçÆ...", "info");
                await loadTranslations();
                showMessage("Êï∞ÊçÆÂà∑Êñ∞ÂÆåÊàê", "success");
            }

            // ÂØºÂá∫Êï∞ÊçÆ
            async function exportData() {
                try {
                    showMessage("Ê≠£Âú®ÂáÜÂ§áÂØºÂá∫Êï∞ÊçÆ...", "info");

                    // ÂàõÂª∫‰∏Ä‰∏™ÈöêËóèÁöÑÈìæÊé•Êù•Ëß¶Âèë‰∏ãËΩΩ
                    const link = document.createElement("a");
                    link.href = `${API_BASE}/export-data`;
                    link.style.display = "none";

                    // Ê∑ªÂä†Âà∞È°µÈù¢Âπ∂ÁÇπÂáª
                    document.body.appendChild(link);
                    link.click();

                    // Ê∏ÖÁêÜ
                    document.body.removeChild(link);

                    showMessage("ÂØºÂá∫ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅÔºåÊñá‰ª∂Â∞ÜËá™Âä®‰∏ãËΩΩ", "success");
                } catch (error) {
                    showMessage("ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // ÂºπÁ™óÂÜÖ‰∏ÄÈîÆÁøªËØë
            async function autoTranslateInModal() {
                // Ëé∑ÂèñÂΩìÂâçË°®Âçï‰∏≠ÁöÑÁøªËØëÂÜÖÂÆπ
                const currentTranslations = {};
                const languageInputs = document.querySelectorAll(
                    "#languageInputs textarea"
                );

                languageInputs.forEach((input) => {
                    const lang = input.getAttribute("data-lang");
                    const value = input.value.trim();
                    if (value) {
                        currentTranslations[lang] = value;
                    }
                });

                // Ê£ÄÊü•ÊòØÂê¶ÊúâÂèØÁî®ÁöÑÊ∫êËØ≠Ë®Ä
                const availableLanguages = Object.keys(currentTranslations);
                if (availableLanguages.length === 0) {
                    showMessage(
                        "ËØ∑ÂÖàËæìÂÖ•Ëá≥Â∞ë‰∏ÄÁßçËØ≠Ë®ÄÁöÑÁøªËØëÂÜÖÂÆπ‰Ωú‰∏∫Ê∫êÊñáÊú¨",
                        "error"
                    );
                    return;
                }

                // ËÆ©Áî®Êà∑ÈÄâÊã©Ê∫êËØ≠Ë®Ä
                const sourceLanguage =
                    availableLanguages.length === 1
                        ? availableLanguages[0]
                        : prompt(
                              `ËØ∑ÈÄâÊã©Ê∫êËØ≠Ë®Ä (${availableLanguages.join(", ")})Ôºö`,
                              availableLanguages.includes("zh")
                                  ? "en"
                                  : availableLanguages[0]
                          );

                if (!sourceLanguage) return;

                if (!currentTranslations[sourceLanguage]) {
                    showMessage(
                        `Ê∫êËØ≠Ë®Ä ${sourceLanguage} ÁöÑÁøªËØëÂÜÖÂÆπ‰∏∫Á©∫`,
                        "error"
                    );
                    return;
                }

                const confirmMsg = `Á°ÆÂÆöË¶Å‰ΩøÁî® "${currentTranslations[sourceLanguage]}" ‰Ωú‰∏∫Ê∫êÊñáÊú¨ÔºåËá™Âä®ÁøªËØëÂà∞ÂÖ∂‰ªñËØ≠Ë®ÄÂêóÔºü`;
                if (!confirm(confirmMsg)) return;

                try {
                    showMessage("Ê≠£Âú®Ëá™Âä®ÁøªËØëÔºåËØ∑Á®çÂÄô...", "info");

                    // ‰ΩøÁî®Á∫ØÁøªËØëAPIÔºå‰∏ç‰øùÂ≠òÊñá‰ª∂
                    const targetLanguages = languages.filter(
                        (lang) => lang !== sourceLanguage
                    );

                    const response = await fetch(`${API_BASE}/translate-only`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            text: currentTranslations[sourceLanguage],
                            sourceLanguage: sourceLanguage,
                            targetLanguages: targetLanguages,
                        }),
                    });

                    const result = await response.json();

                    if (result.success) {
                        // Êõ¥Êñ∞Ë°®Âçï‰∏≠ÁöÑÁøªËØëÂÜÖÂÆπ
                        Object.entries(result.results).forEach(
                            ([lang, translation]) => {
                                const input = document.querySelector(
                                    `textarea[data-lang="${lang}"]`
                                );
                                if (input && translation) {
                                    input.value = translation;
                                }
                            }
                        );

                        showMessage(
                            `Ëá™Âä®ÁøªËØëÂÆåÊàêÔºÅÁøªËØë‰∫Ü ${Object.keys(result.results).length} ÁßçËØ≠Ë®Ä„ÄÇÁÇπÂáª‰øùÂ≠òÊåâÈíÆÊù•‰øùÂ≠òÊõ¥Êîπ„ÄÇ`,
                            "success"
                        );

                        if (result.errors && result.errors.length > 0) {
                            showMessage(
                                `ÈÉ®ÂàÜÁøªËØëÂ§±Ë¥•: ${result.errors.join(", ")}`,
                                "warning"
                            );
                        }
                    } else {
                        throw new Error(result.error || "Ëá™Âä®ÁøªËØëÂ§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("Ëá™Âä®ÁøªËØëÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // ‰∏ÄÈîÆÁøªËØëÔºàË°®Ê†º‰∏≠ÁöÑÊåâÈíÆÔºâ
            async function autoTranslate(id) {
                const translation = allTranslations.find((t) => t.id === id);
                if (!translation) return;

                const sourceLanguage = prompt(
                    "ËØ∑ÈÄâÊã©Ê∫êËØ≠Ë®Ä (zh, en, zh-TW Á≠â):",
                    "zh"
                );
                if (!sourceLanguage) return;

                if (!translation.translations[sourceLanguage]) {
                    showMessage(
                        `Ê∫êËØ≠Ë®Ä ${sourceLanguage} ÁöÑÁøªËØë‰∏çÂ≠òÂú®`,
                        "error"
                    );
                    return;
                }

                const confirmMsg = `Á°ÆÂÆöË¶Å‰ΩøÁî® "${translation.translations[sourceLanguage]}" ‰Ωú‰∏∫Ê∫êÊñáÊú¨ÔºåËá™Âä®ÁøªËØëÂà∞ÂÖ∂‰ªñËØ≠Ë®ÄÂêóÔºü`;
                if (!confirm(confirmMsg)) return;

                try {
                    showMessage("Ê≠£Âú®Ëá™Âä®ÁøªËØëÔºåËØ∑Á®çÂÄô...", "success");

                    const response = await fetch(
                        `${API_BASE}/auto-translate/${id}`,
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ sourceLanguage }),
                        }
                    );

                    const result = await response.json();

                    if (result.success) {
                        showMessage(
                            `Ëá™Âä®ÁøªËØëÂÆåÊàêÔºÅÁøªËØë‰∫Ü ${Object.keys(result.results).length} ÁßçËØ≠Ë®Ä`,
                            "success"
                        );
                        if (result.errors && result.errors.length > 0) {
                            showMessage(
                                `ÈÉ®ÂàÜÁøªËØëÂ§±Ë¥•: ${result.errors.join(", ")}`,
                                "error"
                            );
                        }
                        refreshData();
                    } else {
                        throw new Error(result.error || "Ëá™Âä®ÁøªËØëÂ§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("Ëá™Âä®ÁøªËØëÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // ÊâπÈáèÁøªËØë
            async function batchTranslate() {
                const sourceLanguage = prompt(
                    "ËØ∑ÈÄâÊã©Ê∫êËØ≠Ë®Ä (zh, en, zh-TW Á≠â):",
                    "zh"
                );
                if (!sourceLanguage) return;

                const targetLanguagesInput = prompt(
                    "ËØ∑ËæìÂÖ•ÁõÆÊ†áËØ≠Ë®ÄÔºåÁî®ÈÄóÂè∑ÂàÜÈöî (ÁïôÁ©∫ÂàôÁøªËØëÂà∞ÊâÄÊúâÂÖ∂‰ªñËØ≠Ë®Ä):",
                    ""
                );
                const targetLanguages = targetLanguagesInput
                    ? targetLanguagesInput.split(",").map((lang) => lang.trim())
                    : null;

                // Ëé∑ÂèñÂΩìÂâçÊòæÁ§∫ÁöÑÁøªËØëIDÂàóË°®
                const visibleTranslations = document.querySelectorAll(
                    "#translationsTable tr"
                );
                const ids = [];

                visibleTranslations.forEach((row) => {
                    const editBtn = row.querySelector(
                        'button[onclick*="editTranslation"]'
                    );
                    if (editBtn) {
                        const onclick = editBtn.getAttribute("onclick");
                        const id = onclick.match(
                            /editTranslation\((\d+)\)/
                        )?.[1];
                        if (id) ids.push(parseInt(id));
                    }
                });

                if (ids.length === 0) {
                    showMessage("Ê≤°ÊúâÊâæÂà∞ÂèØÁøªËØëÁöÑÊù°ÁõÆ", "error");
                    return;
                }

                const confirmMsg = `Á°ÆÂÆöË¶ÅÊâπÈáèÁøªËØë ${ids.length} ‰∏™Êù°ÁõÆÂêóÔºüËøôÂèØËÉΩÈúÄË¶ÅËæÉÈïøÊó∂Èó¥„ÄÇ`;
                if (!confirm(confirmMsg)) return;

                try {
                    showMessage(
                        `Ê≠£Âú®ÊâπÈáèÁøªËØë ${ids.length} ‰∏™Êù°ÁõÆÔºåËØ∑ËÄêÂøÉÁ≠âÂæÖ...`,
                        "success"
                    );

                    const response = await fetch(
                        `${API_BASE}/batch-translate`,
                        {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({
                                ids,
                                sourceLanguage,
                                targetLanguages,
                            }),
                        }
                    );

                    const result = await response.json();

                    if (result.success) {
                        showMessage(
                            `ÊâπÈáèÁøªËØëÂÆåÊàêÔºÅÂ§ÑÁêÜ‰∫Ü ${result.results.length} ‰∏™Êù°ÁõÆ`,
                            "success"
                        );
                        if (result.errors && result.errors.length > 0) {
                            showMessage(
                                `ÈÉ®ÂàÜÁøªËØëÂ§±Ë¥•: ${result.errors.slice(0, 5).join(", ")}${result.errors.length > 5 ? "..." : ""}`,
                                "error"
                            );
                        }
                        refreshData();
                    } else {
                        throw new Error(result.error || "ÊâπÈáèÁøªËØëÂ§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("ÊâπÈáèÁøªËØëÂ§±Ë¥•: " + error.message, "error");
                }
            }

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            function closeModal() {
                document.getElementById("editModal").style.display = "none";
            }

            // ÊòæÁ§∫Ê∂àÊÅØÂºπÁ™ó
            function showMessage(message, type = "success") {
                const modal = document.getElementById("messageModal");
                const title = document.getElementById("messageTitle");
                const icon = document.getElementById("messageIcon");
                const text = document.getElementById("messageText");
                const closeBtn = modal.querySelector(".close");
                const confirmBtn = modal.querySelector("button");

                // ËÆæÁΩÆÂõæÊ†áÂíåÊ†áÈ¢ò
                switch (type) {
                    case "success":
                        title.textContent = "ÊàêÂäü";
                        icon.textContent = "‚úÖ";
                        icon.style.color = "#28a745";
                        break;
                    case "error":
                        title.textContent = "ÈîôËØØ";
                        icon.textContent = "‚ùå";
                        icon.style.color = "#dc3545";
                        break;
                    case "warning":
                        title.textContent = "Ë≠¶Âëä";
                        icon.textContent = "‚ö†Ô∏è";
                        icon.style.color = "#ffc107";
                        break;
                    case "info":
                        title.textContent = "‰ø°ÊÅØ";
                        icon.textContent = "‚ÑπÔ∏è";
                        icon.style.color = "#17a2b8";
                        break;
                    default:
                        title.textContent = "ÊèêÁ§∫";
                        icon.textContent = "üí¨";
                        icon.style.color = "#6c757d";
                }

                text.textContent = message;

                // ÂØπ‰∫éÊ≠£Âú®ËøõË°åÁöÑÊìç‰ΩúÔºàinfoÁ±ªÂûãÔºâÔºåÈöêËóèÂÖ≥Èó≠ÊåâÈíÆ
                if (type === "info") {
                    closeBtn.style.display = "none";
                    confirmBtn.style.display = "none";
                } else {
                    closeBtn.style.display = "block";
                    confirmBtn.style.display = "block";
                }

                modal.style.display = "block";

                // 3ÁßíÂêéËá™Âä®ÂÖ≥Èó≠ÔºàÈô§‰∫ÜÈîôËØØÊ∂àÊÅØÂíåinfoÊ∂àÊÅØÔºâ
                if (type !== "error" && type !== "info") {
                    // setTimeout(() => {
                    //     closeMessageModal();
                    // }, 3000);
                }
            }

            // ÂÖ≥Èó≠Ê∂àÊÅØÂºπÁ™ó
            function closeMessageModal() {
                document.getElementById("messageModal").style.display = "none";
            }

            // ÊòæÁ§∫Êñ∞Â¢ûÊñá‰ª∂Ê®°ÊÄÅÊ°Ü
            function showAddFileModal() {
                document.getElementById("newFileName").value = "";
                document.getElementById("addFileModal").style.display = "block";
            }

            // ÂÖ≥Èó≠Êñ∞Â¢ûÊñá‰ª∂Ê®°ÊÄÅÊ°Ü
            function closeAddFileModal() {
                document.getElementById("addFileModal").style.display = "none";
            }

            // Êñ∞Â¢ûÊñá‰ª∂Ë°®ÂçïÊèê‰∫§
            document.addEventListener("DOMContentLoaded", function () {
                document
                    .getElementById("addFileForm")
                    .addEventListener("submit", async function (e) {
                        e.preventDefault();
                        await createNewFile();
                    });
            });

            // ÂàõÂª∫Êñ∞Êñá‰ª∂
            async function createNewFile() {
                const fileName = document.getElementById("newFileName").value.trim();

                if (!fileName) {
                    showMessage("ËØ∑ËæìÂÖ•Êñá‰ª∂Âêç", "error");
                    return;
                }

                // È™åËØÅÊñá‰ª∂ÂêçÊ†ºÂºèÔºàÂè™ÂÖÅËÆ∏Â≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅËøûÂ≠óÁ¨¶Âíå‰∏ãÂàíÁ∫øÔºâ
                if (!/^[a-zA-Z0-9_-]+$/.test(fileName)) {
                    showMessage(
                        "Êñá‰ª∂ÂêçÂè™ËÉΩÂåÖÂê´Â≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅËøûÂ≠óÁ¨¶Âíå‰∏ãÂàíÁ∫ø",
                        "error"
                    );
                    return;
                }

                // Ê£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â∑≤Â≠òÂú®
                if (files.includes(fileName)) {
                    showMessage("Êñá‰ª∂ÂêçÂ∑≤Â≠òÂú®ÔºåËØ∑‰ΩøÁî®ÂÖ∂‰ªñÂêçÁß∞", "error");
                    return;
                }

                try {
                    showMessage(`Ê≠£Âú®ÂàõÂª∫Êñá‰ª∂ ${fileName}.json...`, "info");

                    const response = await fetch(`${API_BASE}/create-file`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ fileName }),
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        showMessage(
                            `ÊàêÂäüÂú® ${result.createdCount} ‰∏™ËØ≠Ë®ÄÊñá‰ª∂Â§π‰∏≠ÂàõÂª∫‰∫Ü ${fileName}.json`,
                            "success"
                        );
                        closeAddFileModal();
                        
                        // Âà∑Êñ∞Êï∞ÊçÆ
                        await loadInitialData();
                    } else {
                        throw new Error(result.error || "ÂàõÂª∫Êñá‰ª∂Â§±Ë¥•");
                    }
                } catch (error) {
                    showMessage("ÂàõÂª∫Êñá‰ª∂Â§±Ë¥•: " + error.message, "error");
                }
            }

            
        </script>
    </body>
</html>
